<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36" version="29.0.3">
  <diagram name="Retry with Circuit Breaker" id="retry-circuit-breaker-diagram">
    <mxGraphModel dx="763" dy="566" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="2400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" value="&lt;b&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;Retry com Exponential Backoff + Circuit Breaker&lt;/font&gt;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="70" y="30" width="710" height="40" as="geometry" />
        </mxCell>
        <mxCell id="subtitle" value="EstratÃ©gia de ResiliÃªncia com Jitter e ProteÃ§Ã£o contra Cascading Failures" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=2" parent="1" vertex="1">
          <mxGeometry x="150" y="70" width="550" height="25" as="geometry" />
        </mxCell>
        <mxCell id="divider1" value="" style="endArrow=none;html=1;strokeColor=#000000;strokeWidth=2;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="70" y="120" as="sourcePoint" />
            <mxPoint x="780" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="initial-section" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="70" y="150" width="710" height="100" as="geometry" />
        </mxCell>
        <mxCell id="initial-title" value="&lt;b&gt;REQUISIÃ‡ÃƒO INICIAL&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="90" y="165" width="250" height="25" as="geometry" />
        </mxCell>
        <mxCell id="initial-consumer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="120" y="200" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="initial-consumer-label" value="&lt;b&gt;Kafka Consumer&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="120" y="210" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="arrow-initial" value="&lt;b&gt;HTTP POST&lt;/b&gt;" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=11;" parent="1" source="initial-consumer" target="initial-service" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="initial-service" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="380" y="200" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="initial-service-label" value="&lt;b&gt;External API&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="370" y="210" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="initial-error" value="âŒ &lt;b&gt;FALHA&lt;/b&gt; (500, Timeout, Connection Error)" style="text;html=1;strokeColor=none;fillColor=#ffffff;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=10;fontStyle=1;fontColor=#8B0000;strokeWidth=2;strokeColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="600" y="205" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="arrow-to-retry" value="" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=4;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="initial-section" target="retry-section" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="retry-section" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="70" y="300" width="710" height="900" as="geometry" />
        </mxCell>
        <mxCell id="retry-title" value="&lt;b&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;ESTRATÃ‰GIA DE RETRY: EXPONENTIAL BACKOFF + JITTER&lt;/font&gt;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="175" y="315" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="retry1-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="100" y="370" width="640" height="120" as="geometry" />
        </mxCell>
        <mxCell id="retry1-title" value="&lt;b&gt;TENTATIVA #1 (apÃ³s falha inicial)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="115" y="380" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="retry1-formula" value="&lt;font face=&quot;Courier New&quot;&gt;&amp;nbsp;base_delay = 2^1 = 2 segundos&lt;br&gt;&amp;nbsp;jitter = random(0, 2) = 0.7 seg  &lt;i&gt;(randomizaÃ§Ã£o para evitar thundering herd)&lt;/i&gt;&lt;br&gt;&lt;b&gt;&amp;nbsp;wait_time = 2 + 0.7 = 2.7 segundos&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=10;strokeWidth=1;strokeColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="120" y="410" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="retry1-result" value="âŒ &lt;b&gt;FALHOU&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#8B0000;strokeWidth=2;fontSize=10;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="640" y="420" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="retry1-counter" value="&lt;b&gt;Failures: 1&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="120" y="460" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="arrow-retry1-2" value="" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="retry1-box" target="retry2-box" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="retry2-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="100" y="520" width="640" height="120" as="geometry" />
        </mxCell>
        <mxCell id="retry2-title" value="&lt;b&gt;TENTATIVA #2&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="115" y="530" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="retry2-formula" value="&lt;font face=&quot;Courier New&quot;&gt;&amp;nbsp;base_delay = 2^2 = 4 segundos&lt;br&gt;&amp;nbsp;jitter = random(0, 4) = 1.3 seg&lt;br&gt;&lt;b&gt;&amp;nbsp;wait_time = 4 + 1.3 = 5.3 segundos&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=10;strokeWidth=1;strokeColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="120" y="560" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="retry2-result" value="âŒ &lt;b&gt;FALHOU&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#8B0000;strokeWidth=2;fontSize=10;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="640" y="570" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="retry2-counter" value="&lt;b&gt;Failures: 2&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="120" y="610" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="arrow-retry2-3" value="" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="retry2-box" target="retry3-box" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="retry3-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="100" y="670" width="640" height="120" as="geometry" />
        </mxCell>
        <mxCell id="retry3-title" value="&lt;b&gt;TENTATIVA #3&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="115" y="680" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="retry3-formula" value="&lt;font face=&quot;Courier New&quot;&gt;&amp;nbsp;base_delay = 2^3 = 8 segundos&lt;br&gt;&amp;nbsp;jitter = random(0, 8) = 2.9 seg&lt;br&gt;&lt;b&gt;&amp;nbsp;wait_time = 8 + 2.9 = 10.9 segundos&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=10;strokeWidth=1;strokeColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="120" y="710" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="retry3-result" value="âŒ &lt;b&gt;FALHOU&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#8B0000;strokeWidth=2;fontSize=10;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="640" y="720" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="retry3-counter" value="&lt;b&gt;Failures: 3&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="120" y="760" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="arrow-retry3-4" value="" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="retry3-box" target="retry4-box" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="retry4-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="100" y="820" width="640" height="120" as="geometry" />
        </mxCell>
        <mxCell id="retry4-title" value="&lt;b&gt;TENTATIVA #4&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="115" y="830" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="retry4-formula" value="&lt;font face=&quot;Courier New&quot;&gt;&amp;nbsp;base_delay = 2^4 = 16 segundos  &lt;i&gt;(aplicando max_delay cap)&lt;/i&gt;&lt;br&gt;&amp;nbsp;max_delay = 15 segundos  &lt;b&gt;â† limite configurado&lt;/b&gt;&lt;br&gt;&amp;nbsp;jitter = random(0, 15) = 4.2 seg&lt;br&gt;&lt;b&gt;&amp;nbsp;wait_time = 15 + 4.2 = 19.2 segundos&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=10;strokeWidth=1;strokeColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="120" y="860" width="500" height="60" as="geometry" />
        </mxCell>
        <mxCell id="retry4-result" value="âŒ &lt;b&gt;FALHOU&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#8B0000;strokeWidth=2;fontSize=10;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="640" y="870" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="retry4-counter" value="&lt;b&gt;Failures: 4&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="120" y="920" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="arrow-retry4-5" value="" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=3;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="retry4-box" target="retry5-box" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="retry5-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#8B0000;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="100" y="970" width="640" height="120" as="geometry" />
        </mxCell>
        <mxCell id="retry5-title" value="&lt;b&gt;TENTATIVA #5 (ÃšLTIMA TENTATIVA ANTES DO CIRCUIT BREAKER)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="115" y="980" width="500" height="20" as="geometry" />
        </mxCell>
        <mxCell id="retry5-formula" value="&lt;font face=&quot;Courier New&quot;&gt;&amp;nbsp;base_delay = 2^5 = 32 segundos (capped to max_delay = 15)&lt;br&gt;&amp;nbsp;jitter = random(0, 15) = 6.8 seg&lt;br&gt;&lt;b&gt;&amp;nbsp;wait_time = 15 + 6.8 = 21.8 segundos&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=10;strokeWidth=1;strokeColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="120" y="1010" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="retry5-result" value="âŒ &lt;b&gt;FALHOU&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#8B0000;strokeColor=#8B0000;strokeWidth=2;fontSize=10;fontStyle=1;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="640" y="1020" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="retry5-counter" value="&lt;b&gt;Failures: 5 âš ï¸ THRESHOLD ATINGIDO&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=9;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="120" y="1060" width="250" height="20" as="geometry" />
        </mxCell>
        <mxCell id="jitter-explanation" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#000000;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="137.5" y="1110" width="560" height="70" as="geometry" />
        </mxCell>
        <mxCell id="jitter-title" value="&lt;b&gt;ðŸ’¡ O QUE Ã‰ JITTER?&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="152.5" y="1115" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="jitter-text" value="RandomizaÃ§Ã£o adicionada ao delay para evitar &lt;b&gt;thundering herd problem&lt;/b&gt; (quando mÃºltiplos consumidores&lt;br&gt;fazem retry simultaneamente, sobrecarregando o sistema). Com jitter, os retries ficam distribuÃ­dos no tempo." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="152.5" y="1140" width="610" height="30" as="geometry" />
        </mxCell>
        <mxCell id="arrow-to-cb" value="" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=5;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="retry-section" target="circuit-breaker-section" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="circuit-breaker-section" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#8B0000;strokeColor=#000000;strokeWidth=4;" parent="1" vertex="1">
          <mxGeometry x="70" y="1260" width="710" height="280" as="geometry" />
        </mxCell>
        <mxCell id="cb-title" value="&lt;b&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;âš¡ CIRCUIT BREAKER ATIVADO âš¡&lt;/font&gt;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="225" y="1280" width="400" height="30" as="geometry" />
        </mxCell>
        <mxCell id="cb-subtitle" value="Estado: OPEN - Interrompendo tentativas para proteger o sistema" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=2;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="225" y="1310" width="400" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cb-actions" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="100" y="1350" width="640" height="180" as="geometry" />
        </mxCell>
        <mxCell id="cb-actions-title" value="&lt;b&gt;AÃ‡Ã•ES DO CIRCUIT BREAKER:&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="115" y="1354" width="300" height="20" as="geometry" />
        </mxCell>
        <mxCell id="cb-action1" value="&lt;b&gt;1. INTERRUPÃ‡ÃƒO IMEDIATA:&lt;/b&gt;&lt;br&gt;   â€¢ Novas requisiÃ§Ãµes para o serviÃ§o externo sÃ£o bloqueadas&lt;br&gt;   â€¢ Retorna erro imediatamente (fail-fast) sem tentar conectar&lt;br&gt;   â€¢ Economiza recursos (threads, conexÃµes, tempo)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="120" y="1370" width="610" height="45" as="geometry" />
        </mxCell>
        <mxCell id="cb-action2" value="&lt;b&gt;2. FALLBACK:&lt;/b&gt;&lt;br&gt;   â€¢ Envia mensagem para Dead Letter Queue (DLQ)&lt;br&gt;   â€¢ Ou executa lÃ³gica alternativa (cache, resposta padrÃ£o)&lt;br&gt;   â€¢ Registra mÃ©trica: circuit_breaker_open_count++" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="120" y="1421" width="610" height="40" as="geometry" />
        </mxCell>
        <mxCell id="cb-action3" value="&lt;b&gt;3. RECOVERY TIMER:&lt;/b&gt;&lt;br&gt;   â€¢ ApÃ³s 60 segundos, transiciona para estado HALF-OPEN&lt;br&gt;   â€¢ Permite uma requisiÃ§Ã£o de teste (health check)&lt;br&gt;   â€¢ Se sucesso â†’ CLOSED (retoma operaÃ§Ã£o normal) | Se falha â†’ OPEN novamente" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="120" y="1472" width="610" height="40" as="geometry" />
        </mxCell>
        <mxCell id="states-section" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#000000;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="70" y="1590" width="710" height="240" as="geometry" />
        </mxCell>
        <mxCell id="states-title" value="&lt;b&gt;ESTADOS DO CIRCUIT BREAKER&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="275" y="1591" width="300" height="25" as="geometry" />
        </mxCell>
        <mxCell id="state-closed" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#006400;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="100" y="1645" width="150" height="165" as="geometry" />
        </mxCell>
        <mxCell id="state-closed-title" value="&lt;b&gt;CLOSED&lt;/b&gt;&lt;br&gt;(Normal)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#006400;" parent="1" vertex="1">
          <mxGeometry x="95" y="1651" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="state-closed-desc" value="âœ… RequisiÃ§Ãµes fluem&lt;br&gt;normalmente&lt;br&gt;&lt;br&gt;â€¢ Conta falhas&lt;br&gt;â€¢ Se failures &amp;gt;= threshold&lt;br&gt;&amp;nbsp;&amp;nbsp;â†’ vai para OPEN&lt;br&gt;&lt;br&gt;â€¢ Reseta contador&lt;br&gt;&amp;nbsp;&amp;nbsp;em sucesso" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="115" y="1693" width="170" height="100" as="geometry" />
        </mxCell>
        <mxCell id="state-open" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#8B0000;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="325" y="1645" width="155" height="165" as="geometry" />
        </mxCell>
        <mxCell id="state-open-title" value="&lt;b&gt;OPEN&lt;/b&gt;&lt;br&gt;(Circuito Aberto)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#8B0000;" parent="1" vertex="1">
          <mxGeometry x="322.5" y="1651" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="state-open-desc" value="âŒ RequisiÃ§Ãµes rejeitadas&lt;br&gt;imediatamente&lt;br&gt;&lt;br&gt;â€¢ Fail-fast&lt;br&gt;â€¢ NÃ£o tenta conectar&lt;br&gt;â€¢ Economiza recursos&lt;br&gt;&lt;br&gt;â€¢ ApÃ³s timeout (60s)&lt;br&gt;&amp;nbsp;&amp;nbsp;â†’ vai para HALF-OPEN" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="340" y="1692" width="170" height="100" as="geometry" />
        </mxCell>
        <mxCell id="state-halfopen" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#FF8C00;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="550" y="1645" width="200" height="165" as="geometry" />
        </mxCell>
        <mxCell id="state-halfopen-title" value="&lt;b&gt;HALF-OPEN&lt;/b&gt;&lt;br&gt;(Teste)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#FF8C00;" parent="1" vertex="1">
          <mxGeometry x="570" y="1651" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="state-halfopen-desc" value="âš ï¸ Teste de recuperaÃ§Ã£o&lt;br&gt;&lt;br&gt;â€¢ Permite 1 requisiÃ§Ã£o&amp;nbsp;de teste&lt;br&gt;â€¢ Se sucesso&amp;nbsp; â†’ CLOSED&lt;br&gt;â€¢ Se falha&amp;nbsp; â†’ OPEN novamente" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="1" vertex="1">
          <mxGeometry x="565" y="1681" width="155" height="100" as="geometry" />
        </mxCell>
        <mxCell id="arrow-closed-open" value="&lt;b&gt;failures â‰¥ 5&lt;/b&gt;" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;curved=1;" parent="1" source="state-closed" target="state-open" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-open-half" value="&lt;b&gt;timeout (60s)&lt;/b&gt;" style="endArrow=classic;html=1;strokeColor=#000000;strokeWidth=2;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=8;curved=1;" parent="1" source="state-open" target="state-halfopen" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow-half-closed" value="&lt;b&gt;success&lt;/b&gt;" style="endArrow=classic;html=1;strokeColor=#006400;strokeWidth=2;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=8;curved=1;" parent="1" source="state-halfopen" target="state-closed" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="650" y="1620" />
              <mxPoint x="200" y="1620" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-half-open" value="&lt;b&gt;failure&lt;/b&gt;" style="endArrow=classic;html=1;strokeColor=#8B0000;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=8;curved=1;" parent="1" source="state-halfopen" target="state-open" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="650" y="1840" />
              <mxPoint x="425" y="1840" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="config-section" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#000000;strokeColor=#000000;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="70" y="1880" width="710" height="180" as="geometry" />
        </mxCell>
        <mxCell id="config-title" value="&lt;b&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;CONFIGURAÃ‡ÃƒO RECOMENDADA&lt;/font&gt;&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#ffffff;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="275" y="1895" width="300" height="25" as="geometry" />
        </mxCell>
        <mxCell id="config-code" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="1935" width="640" height="110" as="geometry" />
        </mxCell>
        <mxCell id="config-code-text" value="&lt;font face=&quot;Courier New&quot;&gt;retry_config = {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;max_retries&#39;: 5,                    # NÃºmero mÃ¡ximo de tentativas&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;base_delay&#39;: 2,                     # Delay inicial em segundos (2^1, 2^2, 2^3...)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;max_delay&#39;: 15,                     # Limite mÃ¡ximo de delay para evitar esperas muito longas&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;jitter&#39;: True,                      # Ativa randomizaÃ§Ã£o (jitter)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;circuit_breaker_threshold&#39;: 5,      # Falhas consecutivas para abrir circuito&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;circuit_breaker_timeout&#39;: 60,       # Segundos em estado OPEN antes de testar novamente&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;retry_on&#39;: [500, 502, 503, 504],    # CÃ³digos HTTP que acionam retry&lt;br&gt;}&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=9;" parent="1" vertex="1">
          <mxGeometry x="110" y="1940" width="620" height="100" as="geometry" />
        </mxCell>
        <mxCell id="benefits-section" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="70" y="2110" width="710" height="150" as="geometry" />
        </mxCell>
        <mxCell id="benefits-title" value="&lt;b&gt;BENEFÃCIOS DA ESTRATÃ‰GIA&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" parent="1" vertex="1">
          <mxGeometry x="275" y="2125" width="300" height="25" as="geometry" />
        </mxCell>
        <mxCell id="benefit1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=1;" parent="1" vertex="1">
          <mxGeometry x="90" y="2165" width="310" height="80" as="geometry" />
        </mxCell>
        <mxCell id="benefit1-text" value="&lt;b&gt;ðŸ›¡ï¸ ResiliÃªncia Aumentada&lt;/b&gt;&lt;br&gt;Retry exponencial dÃ¡ tempo para sistemas se recuperarem de falhas temporÃ¡rias. Circuit breaker evita cascading failures, protegendo toda a arquitetura." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="100" y="2172" width="290" height="65" as="geometry" />
        </mxCell>
        <mxCell id="benefit2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#000000;strokeWidth=1;" parent="1" vertex="1">
          <mxGeometry x="430" y="2165" width="320" height="80" as="geometry" />
        </mxCell>
        <mxCell id="benefit2-text" value="&lt;b&gt;âš¡ PrevenÃ§Ã£o de Thundering Herd&lt;/b&gt;&lt;br&gt;Jitter distribui retries no tempo, evitando que mÃºltiplos consumidores sobrecarreguem o sistema simultaneamente apÃ³s uma falha." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" parent="1" vertex="1">
          <mxGeometry x="440" y="2172" width="300" height="65" as="geometry" />
        </mxCell>
        <mxCell id="footer" value="ðŸ’¡ &lt;b&gt;DICA:&lt;/b&gt; Monitore mÃ©tricas como retry_count, circuit_breaker_state e failure_rate para ajustar thresholds e timeouts conforme necessÃ¡rio" style="text;html=1;strokeColor=#000000;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=10;fontStyle=2;strokeWidth=2;" parent="1" vertex="1">
          <mxGeometry x="100" y="2310" width="650" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
